По легенде есть таблица в формате CSV с данными о людях со следующими полями:
ID – основной ключ
PARENT_ID – глава цепочки, изначально не заполнен.
EMAIL
CARD
PHONE
И еще какие-то не интересующие нас в данном случае поля – например, логины, ФИО и т.д. Поля могут идти в другом порядке, да и вообще, формат входных данных может плавать. Для нас важно только то, что нужные нам поля точно есть и они гарантированно заполнены.
Данных много: сотни тысяч – миллионы строк.
 
Известно, что в данных есть дубликаты. Дубликатами считаются записи, у которых совпадает хотя бы одно из ключевых полей (EMAIL, CARD, PHONE). Дубликаты необходимо выстроить в цепочки дуликатов и в PARENT_ID записать найменьший ID из цепочки. 
 
1) Решение должно быть на чистом ПХП.
2) Алгоритм должен быть составлен таким образом, чтобы на больших данных выполняться за разумное время или хотя бы иметь запас для оптимизации.
3) Входящие и исходящие данные в формате CSV из стандартных потоков ввода/вывода - это скорее для моего удобства. У меня просто есть пара заготовленных тестов. :)
4) Различными валидациями, типа корректность емайла или проверка валидности кредитной карты можно, естественно, пренебречь. Считаем, что данные поступают корректные.
---
 
Пример входящих данных №1:
ID,PARENT_ID,EMAIL,CARD,PHONE,TMP
1,NULL,email1,card1,phone1,
2,NULL,email2,card1,phone2,
3,NULL,email3,card3,phone3,
4,NULL,email4,card4,phone2,

Пример входящих данных №2: 
ID,PARENT_ID,EMAIL,CARD,PHONE,TMP
1,NULL,email1,card1,phone1,
2,NULL,email2,card2,phone2,
3,NULL,email3,card3,phone3,
4,NULL,email1,card2,phone3,
